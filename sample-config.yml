# Sample configuration file for Email Sender CLI
# Copy this file and customize it for your use case
# Run with: java -jar email-sender-cli.jar --spring.config.import=/path/to/your-config.yml

email-sender:
  microsoft:
    # Azure AD / Microsoft Entra ID credentials
    # These can also be set via environment variables:
    # AZURE_TENANT_ID, AZURE_CLIENT_ID, AZURE_CLIENT_SECRET
    tenant-id: your-azure-tenant-id
    client-id: your-azure-client-id
    client-secret: your-azure-client-secret

  datasource:
    # Type: 'csv' or 'excel'
    type: excel
    # Path to the data file containing recipient information
    path: /path/to/recipients.xlsx
    # Sheet name (only for Excel files, optional - defaults to first sheet)
    sheet-name: Sheet1
    # Column name that determines if a row should be processed
    process-column: "SendEmail"
    # Value that triggers processing (rows with this value will receive emails)
    process-value: "Yes"

  templates:
    # Path to the Thymeleaf HTML template for email body
    # Use ${fieldName} or [[${fieldName}]] syntax for Thymeleaf variables
    email-body: /path/to/email-template.html
    # Path to the Word document template for PDF attachment
    # Use {{fieldName}} syntax for placeholders in the Word document
    attachment: /path/to/document-template.docx

  email:
    # The user email address that sends emails (required)
    # This user must have a mailbox in your Microsoft 365 tenant
    sender-email: sender@yourcompany.com
    # Optional: group email address to appear as the sender ("from" field)
    # When set, emails are sent via sender-email but appear to come from this group
    # The sender-email user must have "Send As" permission on the group in Exchange Online
    # sender-group: team@yourcompany.com
    # Subject line template - use {{fieldName}} for placeholder substitution
    subject-template: "Hello {{name}}, your report is ready"
    # Column name in the data source containing recipient email addresses
    recipient-column: "Email"
    # Filename for the PDF attachment
    attachment-filename: "report.pdf"

  # Throttling configuration to prevent email rejection due to rate limits
  # Microsoft Graph API / Exchange Online limits:
  # - Exchange Online: 30 emails per minute (the actual bottleneck)
  # - Graph API: 10,000 requests per 10 minutes
  # - Max 4 concurrent requests
  throttling:
    # Enable/disable throttling (default: true)
    enabled: true
    # Maximum emails per minute - default is 30 (Exchange Online limit)
    # Lower this if you experience throttling issues
    emails-per-minute: 30
    # Number of retry attempts when throttled (HTTP 429) - default: 3
    max-retries: 3
    # Initial delay before first retry in milliseconds - default: 2000 (2 seconds)
    # Subsequent retries use exponential backoff (2x multiplier)
    initial-retry-delay-ms: 2000

  # Optional: Map placeholders to different column names in your data source
  # Useful when your column names don't match placeholder names
  field-mappings:
    "{{name}}": "FullName"
    "{{company}}": "CompanyName"
    "{{date}}": "ReportDate"

  # Optional: Generate a CSV report of email sending results
  # The report contains each email address and whether it was sent successfully
  report:
    # Path to the output CSV report file
    # If not set, no report will be generated
    output-path: /path/to/email-report.csv
